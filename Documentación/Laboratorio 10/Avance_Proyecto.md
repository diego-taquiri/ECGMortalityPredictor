# Avance del proyecto

Puedes ver el video de Grupo 12 haciendo clic [aquí](https://github.com/diego-taquiri/ISB-equipo11/raw/main/Documentaci%C3%B3n/Laboratorio%2010/Video_Corregido.mp4).


- [Ver PDF del Avance en Google Docs Viewer](https://docs.google.com/viewer?url=https://github.com/diego-taquiri/ISB-equipo11/raw/main/Documentaci%C3%B3n/Laboratorio%2010/PPT%20Avance.pdf&embedded=true)

### Tabla de contenidos
1. [Problemática](https://github.com/diego-taquiri/ISB-equipo11/blob/main/Documentaci%C3%B3n/Laboratorio%2010/Avance_Proyecto.md#problem%C3%A1tica)
2. [Propuesta de solución](https://github.com/diego-taquiri/ISB-equipo11/blob/main/Documentaci%C3%B3n/Laboratorio%2010/Avance_Proyecto.md#propuesta-de-soluci%C3%B3n)
3. [Materiales y métodos](https://github.com/diego-taquiri/ISB-equipo11/blob/main/Documentaci%C3%B3n/Laboratorio%2010/Avance_Proyecto.md#materiales-y-m%C3%A9todos)
4. [Bibliografía](https://github.com/diego-taquiri/ISB-equipo11/blob/main/Documentaci%C3%B3n/Laboratorio%2010/Avance_Proyecto.md#bibliograf%C3%ADa)

### Problemática
<p align="justify">Las enfermedades cardiovasculares representan la principal causa de defunción en el mundo, cobrándose aproximadamente 17,9 millones de vidas anualmente [1]. Este grupo de trastornos, que incluye cardiopatías coronarias, enfermedades cerebrovasculares y cardiopatías reumáticas, afecta principalmente a países de bajos y medianos ingresos, donde más del 75% de las muertes ocurren [1]. En las Américas, la prevención y tratamiento de estas enfermedades es vital, ya que se estima que causan 2 millones de muertes al año [2]. En Perú, EsSalud advierte que las enfermedades cardiovasculares son la segunda causa de muerte [3]. Un estudio del INEI reveló que más del 40% de las personas mayores de 15 años tienen un riesgo cardiovascular muy alto, siendo el 60% de estos casos en mujeres de 60 años o más [3, 4]. El Dr. José Ercilla, vicepresidente de la Sociedad Peruana de Cardiología (Sopechard), destaca que estas enfermedades representan un desafío futuro, especialmente ante la proyección de un aumento significativo de la población mayor de 50 años para el año 2050 [4].<br>
  
<p align="justify">La miocardiopatía chagásica, principal causa de miocardiopatía no isquémica (MNIC) en América Latina, afecta aproximadamente al 30% de los pacientes infectados y surge durante el desarrollo de la enfermedad de Chagas como su manifestación más grave, siendo esta endémica en toda la región. [5] La enfermedad de Chagas es una afección parasitaria, sistémica, crónica, transmitida por vectores y causada por el protozoario Trypanosoma cruzi, con una firme vinculación con aspectos socioeconómico-culturales deficitarios, considerándola una enfermedad desatendida. [6]  Las características más destacadas de la miocardiopatía chagásica incluyen una miocarditis difusa con fibrosis focal, localizada principalmente en el ápice y segmentos basales de la pared posterior e inferior, lo que da lugar a una enfermedad altamente arritmogénica. [5]<br>
  
<p align="justify">El principal mecanismo de transmisión es vectorial: se da al picar al ser humano, produciendo una lesión y defecando en dicha lesión, donde al rascarse hace que los parásitos ingresen al torrente sanguíneo [8]. Otras modalidades de transmisión son transfusional, congénita, trasplantes de órganos u oral. Aunque la mortalidad ha disminuido significativamente, la enfermedad puede causar consecuencias irreversibles y crónicas en el corazón, el sistema digestivo y el sistema nervioso. [7] La Organización Panamericana de la Salud estima que alrededor de 8 millones de personas están infectadas en estas regiones, lo que provoca aproximadamente 12 000 muertes cada año, siendo su propagación a nivel mundial acelerada debido a la migración humana: se considera que hay unos 75 millones de personas en riesgo de infección. [5, 6]. <br>
  
<p align="justify">Aunque esta enfermedad, conocida como chirimacha, se encuentra poco estudiada en Perú, el área chagásica más importantes se encontró en la vertiente suroccidental del pacifico comprendida entre los 13 y los 19 grados de latitud sur entre las altitudes de 10 a 3,000 msnm y hasta el 2019 se observaba como en la figura 1. [9, 10] La pobreza en las zonas rurales contribuye a la presencia de vectores en viviendas precarias, aumentando el riesgo de infección. Además, la migración de las poblaciones rurales hacia los centros urbanos, incluyendo la capital, ha incrementado la relevancia de esta enfermedad en áreas donde la presencia del vector no ha sido detectada, evidenciando posibles mecanismos de transmisión no vectorial, como en Lima. [9] <br>

<p align="center">
<img src="https://github.com/diego-taquiri/ISB-equipo11/blob/main/Documentaci%C3%B3n/Laboratorio%2010/Images/chagas.png" alt="Descripción de la imagen" width="300"><br> 
<p align="center"><b>Figura 1.</b> Mapa de transmisión vectorial de Chagas en 2019 [11]. <br> 
  
<p align="justify">Para prevenir defunciones prematuras por enfermedades cardiovasculares, es esencial identificar a las personas en alto riesgo y garantizar que reciban el tratamiento adecuado, lo cual requiere un acceso universal a medicamentos y tecnologías esenciales en todos los centros de atención primaria [1]. Expertos en cardiología, resaltados en la revista El Peruano, enfatizan la importancia de reducir la discapacidad y la muerte prematura mediante tratamientos oportunos, así como la necesidad de reducir las listas de espera y adoptar procedimientos menos invasivos para una recuperación más rápida [4]. Además, se subraya la importancia de un trabajo coordinado entre las entidades involucradas para lograr un control efectivo de la enfermedad de chagas, tomando como referencia el éxito de estrategias implementadas en otros países latinoamericanos. [9]

### Propuesta de solución
<p align="justify">Nuestro objetivo es desarrollar un sistema de alerta temprana basado en electrocardiografía (ECG) para la detección de pacientes de alto riesgo de mortalidad por la enfermedad de Chagas en Perú con miras a extenderse a otras patologías cardiovasculares. Este sistema busca impulsar la atención clínica oportuna y reducir la mortalidad asociada a esta enfermedad.<br>
  
<p align="justify">Para lograrlo, utilizaremos técnicas avanzadas de procesamiento de señales y aprendizaje automático. A diferencia de trabajos existentes, como el uso de IA descrito por Chin-Sheng Lin et. al [12], emplearemos la extracción de características mediante la Transformada Wavelet y aplicaremos Tiny Machine Learning (TinyML). Esta combinación nos permitirá identificar patrones específicos en las señales cardíacas de los pacientes con Chagas de manera eficiente y a bajo costo, facilitando su implementación en zonas de bajos recursos.

### Materiales y métodos
#### Protocolo de adquisición de la señal a estudiar 
<p align="justify">El Sami-Trop dataset incluye datos de ECG y mortalidad de 2000 pacientes diagnosticados con cardiomiopatía chagásica. Estos pacientes fueron seleccionados siguiendo criterios clínicos específicos para la enfermedad de Chagas. La selección se basó en la confirmación serológica de la infección por Trypanosoma cruzi y la presencia de signos clínicos de cardiomiopatía, asegurando que todos los pacientes en el estudio cumplen con los criterios diagnósticos necesarios para obtener datos representativos y relevantes para el análisis.
  
<p align="justify">Los electrocardiogramas (ECGs) fueron registrados utilizando máquinas de ECG estándar de 12 derivaciones, comunes en entornos clínicos.Cada grabación de ECG tiene una duración típica de 10 segundos por derivación, y las señales digitales fueron muestreadas a una frecuencia de 400 Hz, lo que asegura una captura detallada de la actividad eléctrica del corazón. Las grabaciones se realizaron en un entorno clínico o hospitalario con los pacientes en reposo en posición supina para reducir la variabilidad debido a la actividad física o la postura.[13]
  
<p align="justify">Para la grabacion de las señales de los pacientes sanos se hace uso del Bitalino. Dado que el bloqueo de rama derecha es la alteración más frecuente al evaluar la presencia de chagas se observara este sintoma. Se caracteriza por un ensanchamiento del complejo QRS y un cambio en la morfología de la onda T en las derivaciones de cara derecha (D3 y AVR). Estas derivaciones serian analizadas por el bitalino y se registraran sus resultados para futuras comparaciones.
  
<p align="justify">Los datos de ECG se almacenaron en formato digital, en archivos que contienen los valores de voltaje para cada derivación a lo largo del tiempo. El preprocesamiento de estos datos incluye la corrección de la línea base para eliminar las derivas y el filtrado para eliminar el ruido. Además, se normalizaron las señales para asegurar la uniformidad en los análisis posteriores. Estos pasos son cruciales para mejorar la calidad de las señales y facilitar su análisis preciso.

<p align="justify"><b>Determinación de características de Chagas</b><br>

<p align="justify">La enfermedad de chagas puede causar diversos tipos de alteraciones de ECG, con una evolución desde un ECG normal a alteraciones definidas, pero que son inespecíficas de la enfermedad, destacando extrasístoles ventriculares y anomalías de la repolarización ventricular.[18]
  
<p align="justify">El estudio de Marques et al[19] reporta anomalías del ECG en poblaciones tanto con tripasonomiasis adquirida por contagio por vector y por contagio oral. Entre los cambios encontrados en pacientes con Chagas, se encuentra en primera instancia la alteración del segmento ST y la onda T (37.86%), la prolongación del segmento QT(2.91%) y bloqueos de la rama derecha (1.94%) y rama izquierda (2.91%). Asimismo reporta arritmias en el 32% de los casos, diagnosticada mediante monitoreo por Holter. Las features para el posterior filtrado de la señal se pueden obtener a partir de estas características. Las del primer grupo, o características dependientes de la forma de la señal necesitan de la determinación de la morfología de tanto las ondas P, T y el complejo QRS tanto en amplitud como en duración. Si bien las arritmias son comunes en pacientes con enfermedad de Chagas, los parámetros derivados de la variabilidad de frecuencia cardiaca (TO, TS, SDNN, RMSSD, NN50 y pNN50)[20] permitirían analizar más a fondo las arritmias que se presentan, estas son el resultado de monitoreo continuo para la detección de aceleraciones o desaceleraciones del ritmo cardiaco después de latidos ectópicos, y son propios de estudios con muestras más largas de las que podemos acceder.

<p align="justify"><b>Remoción de ruido</b><br>

<p align="justify">Para remover el ruido usamos un wavelet Daubechies 4 con 5 niveles de descomposición y un soft thresholding de acuerdo al trabajo de Alfaouri et al[21]. El umbral o threshold se obtiene a partir de la siguiente ecuación: 
  
<p align="center">T= C** sqrt(n*σ(Vs(n))/σ(dj(n)))
  
<p align="justify">Donde: <br>
- <p align="justify">C: Constante=0.01
- <p align="justify">σ(Vs(n)): Desviación estándar de señal original.
- <p align="justify">σ(dj(n)): Desviación estándar de coeficientes de detalle.
- <p align="justify">n: Número de muestras.

<p align="justify">Un segundo filtrado para identificar la onda R se obtiene de un algoritmo hecho a partir del algoritmo Pan-Tompkins. La señal de extracción atenua todos los componentes menos el mayor y se obtiene con la suma de las primera y segunda derivada de la señal por coeficientes ya determinados en el trabajo de Mazomenos et al.[22]

<p align="justify"><b>Extracción de features</b><br>

<p align="justify">La extracción de features se da a partir de ventanas de búsqueda temporales en un proceso de varios pasos:
- <p align="justify">Identificación de onda R: Se identifica la onda R encontrando los máximos locales en la onda de ECG filtrada por el algoritmo. Se determina evaluando la mayor gradiente en una ventana de 30 ms alrededor de los máximos locales.
- <p align="justify">Límites QRS: Se utiliza un thresholdling adaptativo en ventanas de tiempo ya determinadas alrededor del punto correspondiente al pico de la onda R. Se determinan dos ventanas que limitan al complejo QRS, siendo las ondas Q y S mínimos locales entre las ventanas y el pico de la onda R.
- <p align="justify">Ondas P y T: Se determinan ventanas fuera de las ventanas establecidas por la onda R, específicas para onda P y T, cada una con su determinada duración y distancia a sus respectivos picos. Luego el algoritmo evalúa las gradientes alrededor de los picos encontrados. Cualquier error se corrige refinando las ventanas existentes y repitiendo el proceso.

#### Métodos para analizar/procesar la señal
<p align="justify">Para la sección de análisis de datos, se tomará la extracción de características por wavelet de las señales del paso anterior y se aplicará a un dataset para el entrenamiento del modelo de Machine Learning. Este dataset se dividirá en 80% para el set de entrenamiento, 10% para el set de validación y 10% para el set de pruebas. La división del dataset de esta manera permite entrenar el modelo con la mayoría de los datos disponibles, mientras que se reserva una porción para validar y probar el modelo de manera independiente, para evaluar su capacidad de generalización [16].

<p align="justify"> el entrenamiento del modelo, utilizaremos la plataforma Edge Impulse [17], una herramienta diseñada para el desarrollo de sistemas embebidos que facilita el entrenamiento de modelos de inteligencia artificial y su despliegue en hardware, como el Arduino Nano que vamos a utilizar. Edge Impulse ofrece un entorno integral para la recolección de datos, la extracción de características y el entrenamiento de modelos.

<p align="justify">Entrenaremos un modelo tipo Multi-Layer Perceptron (MLP), una red neuronal de múltiples capas. Este modelo es adecuado debido a su simplicidad y eficiencia [17], especialmente porque la extracción de características ya se realizó en el paso anterior mediante transformadas wavelet. La elección de un MLP se debe a que no necesitamos una red convolucional, ya que las características relevantes de las señales ECG ya están extraídas. Optimizaremos el entrenamiento del MLP ajustando los hiperparámetros, como la tasa de aprendizaje, que controla cuánto se ajustan los pesos del modelo con cada iteración; el número de capas ocultas, que afecta la capacidad del modelo para aprender representaciones complejas; y el tamaño de cada capa, que influye en la cantidad de información que puede procesar cada capa.

<p align="justify">Evaluaremos el progreso del entrenamiento mediante métricas como la pérdida (loss), que mide la diferencia entre las predicciones del modelo y los valores reales, y la exactitud (accuracy), que es la proporción de predicciones correctas realizadas por el modelo. Estas métricas serán monitoreadas en el set de validación para asegurar que el modelo no solo se ajuste bien a los datos de entrenamiento, sino que también generalice adecuadamente a datos nuevos, evitando el sobreajuste (overfitting).

#### Plan de análisis de los datos resultantes del procesamiento de las señales
<p align="justify">Para la evaluación del modelo, utilizaremos el set de pruebas y aplicaremos diversas métricas para una evaluación integral. La sensibilidad (recall) mide la proporción de verdaderos positivos, es decir, la capacidad del modelo para identificar correctamente las instancias positivas. La especificidad mide la proporción de verdaderos negativos, indicando la capacidad del modelo para identificar correctamente las instancias negativas. El F1 score, que es la media armónica de la precisión (precision) y la sensibilidad, es especialmente útil en casos de clases desbalanceadas, como en nuestro caso, donde hay pocos pacientes con mortalidad en comparación. Además, utilizaremos la curva ROC (Receiver Operating Characteristic) y el AUC (Area Under the Curve) para evaluar la capacidad del modelo para distinguir entre las diferentes clases. La curva ROC es una representación gráfica de la sensibilidad frente a 1-especificidad, y el AUC proporciona una medida agregada del rendimiento del modelo en todas las posibles tasas de clasificación.

<p align="justify">Este enfoque  nos permitirá no solo entrenar un modelo eficiente para su implementación en un Arduino Nano, sino también asegurarnos de su precisión y capacidad de generalización mediante una evaluación rigurosa.

#### Materiales
<p align="justify">El principal recurso de este proyecto es la base de datos Sami-Trop, que incluye las señales de ECG y los datos de mortalidad de 2000 pacientes con cardiomiopatía chagásica. A partir del bitalino estaremos registrando las señales de pacientes sano. Además, utilizamos metodologías y enfoques descritos en literatura clave, como los artículos "AI-enabled electrocardiography alert intervention and all-cause mortality: a pragmatic randomized clinical trial" [14] y "Deep neural network-estimated electrocardiographic age as a mortality predictor" [15]. Estas referencias nos proporcionan un marco metodológico robusto para la predicción de mortalidad. Para el procesamiento de las señales de ECG, empleamos técnicas de filtrado por wavelets utilizando herramientas de software como MATLAB y Python con librerías como PyWavelets y SciPy. Las transformadas wavelet, como la transformada wavelet discreta y continua, se usan para filtrar y denoizar las señales, preservando características importantes como los complejos QRS.
  
<p align="justify">En términos de hardware y plataformas de desarrollo, utilizamos Edge Impulse para la implementación de modelos de machine learning en dispositivos embebidos, como el Arduino Nano, que se integra con sensores de ECG para la adquisición de nuevas señales. Estos dispositivos permiten realizar un análisis en tiempo real y pueden ser utilizados para validar los modelos desarrollados con el dataset Sami-Trop.


### Bibliografía
<p align="justify">[1] “Enfermedades cardiovasculares”, Who.int. [En línea]. Disponible en: https://www.who.int/es/health-topics/cardiovascular-diseases. 
<p align="justify">[2]“Las enfermedades del corazón siguen siendo la principal causa de muerte en las Américas”, Paho.org. [En línea]. Disponible en: https://www.paho.org/es/noticias/29-9-2021-enfermedades-corazon-siguen-siendo-principal-causa-muerte-americas. 
<p align="justify">[3] “Enfermedades al corazón son la segunda causa de muerte en el Perú”, Essalud, 12-mar-2022. [En línea]. Disponible en: http://noticias.essalud.gob.pe/?inno-noticia=enfermedades-al-corazon-son-la-segunda-causa-de-muerte-en-el-peru.
<p align="justify">[4] INEI, “Instituto Nacional de Estadistica e Informatica”, Gob.pe. [En línea]. Disponible en: https://m.inei.gob.pe/prensa/noticias/el-399-de-peruanos-de-15-y-mas-anos-de-edad-tiene-al-menos-una-comorbilidad-12903/. 
<p align="justify">[5] N. G. Echavarría, L. E. Echeverría, M. Stewart, C. Gallego, y C. Saldarriaga, “Chagas disease: Chronic Chagas cardiomyopathy”, Curr. Probl. Cardiol., vol. 46, núm. 3, p. 100507, 2021.
<p align="justify">[6] “Enfermedad de Chagas (tripanosomiasis americana)”, Who.int. [En línea]. Disponible en: https://www.who.int/es/news-room/fact-sheets/detail/chagas-disease-(american-trypanosomiasis).
<p align="justify">[7] “Enfermedad de Chagas”, Paho.org. [En línea]. Disponible en: https://www.paho.org/es/temas/enfermedad-chagas. 
<p align="justify">[8] M. Martinez Palomino, “Cardiopatía chagásica crónica”, 2022.
<p align="justify">[9] C. N. Velarde, P. Huapaya, Y. E. Blanco, y S. V. Chirinos, “Enfermedad de Chagas”, Gob.pe, 2001. [En línea]. Disponible en: https://bvs.minsa.gob.pe/local/OGEI/796_MS-OGE109.pdf. 
<p align="justify">[10] Sala de situación de salud de la enfermedad de Chagas. SE 32”, Gob.pe, 2022. [En línea]. Disponible en: https://www.dge.gob.pe/portal/docs/tools/teleconferencia/2022/SE332022/03.pdf.
<p align="justify">[11] “Enfermedad de Chagas (tripanosomiasis americana)”, Who.int. [En línea]. Disponible en: https://www.who.int/es/news-room/fact-sheets/detail/chagas-disease-(american-trypanosomiasis).
<p align="justify">[12] C.-S. Lin et al., “AI-enabled electrocardiography alert intervention and all-cause mortality: a pragmatic randomized clinical trial”, Nat. Med., pp. 1–10, 2024.
<p align="justify">[13] me Ribeiro, A. L. P., Ribeiro, A. H., Paixao, G. M. M., Lima, E. M., Horta Ribeiro, M., Pinto Filho, M. M., Gomes, P. R., Oliveira, D. M., Meira Jr, W., Schon, T. B., & Sabino, E. C. (2021). Sami-Trop: 12-lead ECG traces with age and mortality annotations (1.0.0) [Data set]. Zenodo. https://doi.org/10.5281/zenodo.4905618
<p align="justify">[14] Lin, CS., Liu, WT., Tsai, DJ. et al. AI-enabled electrocardiography alert intervention and all-cause mortality: a pragmatic randomized clinical trial. Nat Med (2024). https://doi.org/10.1038/s41591-024-02961-4 (link de acceso libre: https://rdcu.be/dIkU2)
<p align="justify">[15] Lima, E.M., Ribeiro, A.H., Paixão, G.M.M. et al. Deep neural network-estimated electrocardiographic age as a mortality predictor. Nat Commun 12, 5117 (2021). https://doi.org/10.1038/s41467-021-25351-7
<p align="justify">[16] H. V. Denysyuk, R. J. Pinto, P. M. Silva, R. P. Duarte, F. A. Marinho, L. Pimenta, and I. M. Pires, "Algorithms for automated diagnosis of cardiovascular diseases based on ECG data: A comprehensive systematic review," Heliyon, vol. 9, no. 2, 2023. https://doi.org/10.1016/j.heliyon.2023.e13601
<p align="justify">[17] "Adding Custom Learning Blocks," Edge Impulse Documentation, Edge Impulse, [Online]. Available: https://edge-impulse.gitbook.io/docs/edge-impulse-studio/learning-blocks/adding-custom-learning-blocks.
<p align="justify">[18] B. Oliveira and A. Luiz, “Electrocardiogram in Chagas disease,” Revista da Sociedade Brasileira de Medicina Tropical, vol. 51, no. 5, pp. 570–577, Oct. 2018, doi: https://doi.org/10.1590/0037-8682-0184-2018.
<p align="justify">[19] J. Marques, I. Mendoza, B. Noya, H. Acquatella, I. Palacios, and María Marques-Mejias, “ECG Manifestations of the Biggest Outbreak of Chagas Disease due to Oral Infection in Latin-America,” Arquivos Brasileiros de Cardiologia, Jan. 2013, doi: https://doi.org/10.5935/abc.20130144.
<p align="justify">[20] A. C. Alberto, G. A. Limeira, R. C. Pedrosa, V. Zarzoso, and J. Nadal, "ECG-Based Predictors of Sudden Cardiac Death in Chagas’ Disease," in Computing in Cardiology, Rennes, France, Sep. 2017, doi: 10.22489/cinc.2017.087-324
<p align="justify">[21] M. Alfaouri and K. Daqrouq, "ECG signal denoising by wavelet transform thresholding," American Journal of Applied Sciences, vol. 5, no. 3, pp. 276-281, 2008. doi:10.3844/ajassp.2008.276.281.
<p align="justify">[22] E. B. Mazomenos, T. Chen, A. Acharyya, A. Bhattacharya, J. Rosengarten and K. Maharatna, "A Time-Domain Morphology and Gradient based algorithm for ECG feature extraction," 2012 IEEE International Conference on Industrial Technology, Athens, Greece, 2012, pp. 117-122, doi: 10.1109/ICIT.2012.6209924.
